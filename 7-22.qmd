---
title: "7/22"
format: html
execute: 
  echo: false
  message: false
---

```{r}
#|label: setup
suppressPackageStartupMessages({
library(tidyverse)
library(tidybayes)
library(brms)
})
```

```{r}
x <- read_csv("STAR.csv", show_col_types = FALSE)
x_filt <- x %>%
  filter(!is.na(hsgrad))
```

```{r}
model <- brm(
  hsgrad ~ classtype,
  data = x_filt,
  family = gaussian(),
  prior = c(prior(normal(0, 1), class = "Intercept"),
            prior(normal(0, 1), class = "b")),
  iter = 2000,
  warmup = 1000,
  chains = 4,
  cores = 4,
  refresh = 0,
  silent = 2,
  seed = 9
)
summary(model)
plot(model)

posterior_samples <- spread_draws(model, b_classtype_Intercept, b_classtype)
posterior_samples %>%
  gather(key = "parameter", value = "estimate", b_classtype1, b_classtype2) %>%
  ggplot(aes(x = estimate, fill = parameter)) +
  stat_halfeye() +
  labs(title = "Posterior Distributions of Class Type Effect on HS Graduation Rate",
       x = "Effect Estimate",
       y = "Density")
```






Question?

What is the causal effect on graduation rate of class size right now?
Preceptor table: Classtype, hsgrad
units: students

Validity: class size definition could have changed data collection
Stability: Students changing class sizes before graduation
Representativeness: 
Unconfoundnedness:



Quantity of Interest? Causal Effect

